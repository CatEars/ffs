<!-- layout /templates/base.html -->
<app-main>
    <app-header>Echo</app-header>
    <script type="module">
        async function submitEchoText(evt) {
            evt.preventDefault();
            const msg = document.getElementById('message').value;
            const result = await fetch('/api/echo', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    message: msg,
                }),
            });
            const body = await result.json();
            return body.message;
        }

        async function onSubmitEcho(evt) {
            const text = await submitEchoText(evt);
            state.displayText = [text];
        }

        const megaphone = new Megaphone();
        const state = megaphone.declareState({
            displayText: [],
            onSubmitEcho,
        });

        megaphone.renderEach(state.displayText, '#display', (text) => {
            const clone = document.querySelector('#display-content').content.cloneNode(true);
            clone.querySelector('span').innerText = text;
            return clone;
        });
    </script>
    <div>
        <form>
            <div class="form-row">
                <label for="message">Message:</label>
                <input type="text" id="message" name="message" />
            </div>
            <button type="submit" +click="onSubmitEcho">Submit</button>
        </form>
    </div>
    <div id="display">
        <template id="display-content">
            <p>The server response:</p>
            <i><span></span></i>
        </template>
    </div>
</app-main>
