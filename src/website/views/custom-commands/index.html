<!-- layout /templates/base.html -->
<app-main>
    <script type="module">
        async function getCommands() {
            const result = await fetch('/api/custom-commands');
            return await result.json();
        }

        const megaphone = new Megaphone();
        const state = megaphone.declareState({
            commands: [],
            message: megaphone.urlParam('message', null),
        });

        megaphone.renderEach(
            state.commands,
            '#command-list',
            megaphone.webComponent('cli-command', (command) => ({
                command: JSON.stringify(command),
                action: '/api/custom-commands/run',
                method: 'POST',
            }))
        );

        megaphone.renderIf(state.message, '#output-display', (message) => {
            const clone = document.querySelector('#success-display').content.cloneNode(true);
            clone.querySelector('pre').textContent = message;
            return clone;
        });

        megaphone.init();

        state.commands = (await getCommands()).map((cmd, idx) => ({
            ...cmd,
            index: idx,
        }));
    </script>
    <app-header>Commands</app-header>
    <section id="command-list"></section>
    <section id="output-display">
        <template id="success-display">
            <horizontal-ruler></horizontal-ruler>
            <div>
                <p>Output:</p>
                <pre></pre>
            </div>
        </template>
    </section>
</app-main>
